FROM floydhub/dl-base:3.0.0-py2.18
MAINTAINER Russell labs "contact@russellcloud.cn"

#RUN wget -O /root/requirements.txt https://raw.githubusercontent.com/PaddlePaddle/Paddle/develop/python/requirements.txt

#RUN LD_LIBRARY_PATH=/opt/_internal/cpython-2.7.11-ucs4/lib:${LD_LIBRARY_PATH} /opt/python/cp27-cp27mu/bin/pip install -r /root/requirements.txt && \
#    LD_LIBRARY_PATH=/opt/_internal/cpython-2.7.11-ucs2/lib:${LD_LIBRARY_PATH} /opt/python/cp27-cp27m/bin/pip install -r /root/requirements.txt && \
#    go get github.com/Masterminds/glide && \
#    rm -rf /root/requirements.txt

RUN git clone https://github.com/paddlepaddle/paddle \
    && cd paddle && mkdir build \
    && cmake -DWITH_GPU=OFF \
             -DWITH_TESTING=OFF \
             -DWITH_MKL=ON \
             -DWITH_DOC=ON \
             -DPY_WHEEL=/usr/local/lib/python2.7/site-packages/wheel \
             -DPY_GOOGLE.PROTOBUF=/usr/local/lib/python2.7/site-packages/google/protobuf \
    && make -j `nproc`

#             -DOPENBLAS_ROOT=<openblas_path> \

RUN pip install build/python/dist/*.whl
